<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<head>
    <!--- START CSS LAYOUT -->
    <link href="css/simple-line-icons.css" rel="stylesheet" type="text/css">
    <link href="css/components.css" rel="stylesheet" id="style_components" type="text/css">
    <link href="css/layout.css" rel="stylesheet" type="text/css">
    <!--- END CSS LAYOUT -->
    <!--- START CSS CHART -->
    <link type="text/css" href="css/main.css" rel="stylesheet" />
    <link type="text/css" href="js/lib/leaflet.css" rel="stylesheet" />
    <link type="text/css" href="js/lib/leaflet.markercluster.css" rel="stylesheet" />
    <link type="text/css" href="js/lib/dc.css" rel="stylesheet" />
    <link type="text/css" href="css/bulletChart.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,200,300,400,600,900" rel="stylesheet">
    <!--- END CSS CHART -->
</head>

<body class="">
    <span id="chart">
    </span>
    <span id="chart-res">
    </span>
    <!-- START JS -->
    <script type="text/javascript" src="js/lib/d3.js"></script>
    <script type="text/javascript" src="js/lib/crossfilter.js"></script>
    <script type="text/javascript" src="js/lib/dc.js"></script>
    <script type="text/javascript" src="js/lib/leaflet.js"></script>
    <script type="text/javascript" src="js/lib/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="js/lib/dc.leaflet.js"></script>
    <script type="text/javascript" src="js/lib/bulletTooltips.js"></script>
    <!-- END JS -->
    <script type="text/javascript">
        var residentialMarketFile = "";
        var hostpitalityMarketFile = "";
        var targeFile = "";
        var transFile = "";

        var xfResidential,
            xfHospitality,
            xfTarget,
            xfProductSaleData;
        //Read in input files to variables
        d3.csv(residentialMarketFile, function(data) {
            xfResidential = crossfilter(data);
        });
        d3.csv(hostpitalityMarketFile, function(data) {
            xfHospitality = crossfilter(data);
        });
        d3.csv(transFile, function(data) {
            xfProductSaleData = crossfilter(data);
        });

        function drawSaleTargetBulletChartResidential() {
          // Target market share:
          // all : 60% total of total
          var pTitle, pRangeMax, pMeasureActual, pMeasureExpect, pMarker, targetMarketShare;
          var chartData = [];
          var data = [];
          var datacf;
          var titleDimension;


          //Total hotel
          targetMarketShare = 0.6;
          pTitle = "Private Condo";
          pRangeMax = 3420;
          pMeasureActual = 2950;
          pMeasureExpect = Math.round(pRangeMax * targetMarketShare);
          data = getBulletData(pTitle, pRangeMax, pMeasureActual, pMeasureExpect);
          chartData.push(data);

          var targetBulletChartResidential = d3.bullet();
          drawTargetBulletChart(targetBulletChartResidential, chartData, "#sales-target-residential-chart");
        }

        function drawSaleTargetBulletChartHospitality() {
            // Target market share:
            // 5 star: 75% total of 5 stars
            // 4 star: 50% total of 4 stars
            // all : 60% total of total
            var pTitle, pRangeMax, pMeasureActual, pMeasureExpect, pMarker, targetMarketShare;
            var chartData = [];
            var data = [];
            var datacf;
            var titleDimension;


            //Total hotel
            targetMarketShare = 0.6;
            pTitle = "Total Hotel Mkt";
            pRangeMax = 1420;
            pMeasureActual = 1250;
            pMeasureExpect = Math.round(pRangeMax * targetMarketShare);
            data = getBulletData(pTitle, pRangeMax, pMeasureActual, pMeasureExpect);
            chartData.push(data);


            //4 Star hotel
            targetMarketShare = 0.5;
            pTitle = "4-Star Hotel";
            pRangeMax = 771;
            pMeasureActual = 500;
            pMeasureExpect = Math.round(pRangeMax * targetMarketShare);
            data = getBulletData(pTitle, pRangeMax, pMeasureActual, pMeasureExpect);
            chartData.push(data);

            //5 Star hotel
            targetMarketShare = 0.75;
            pTitle = "5-Star Hotel";
            pRangeMax = 420;
            pMeasureActual = 250;
            pMeasureExpect = Math.round(pRangeMax * targetMarketShare);
            data = getBulletData(pTitle, pRangeMax, pMeasureActual, pMeasureExpect);
            chartData.push(data);

            var targetBulletChart2 = d3.bullet();
            drawTargetBulletChart(targetBulletChart2, chartData, "#sales-target-hospitality-chart");

        }

        function getBulletData(pTitle, pRangeMax, pMeasureActual, pMeasureExpect) {
            var title,
                range_min,
                range_mid,
                range_max,
                measure_actual,
                measure_expect,
                marker;

            title = pTitle;
            range_min = Math.round(pRangeMax * 60 / 100);
            range_mid = Math.round(pRangeMax * 75 / 100);
            range_max = Math.round(pRangeMax * 100 / 100);
            measure_actual = +pMeasureActual;
            measure_expect = +pMeasureExpect;
            marker = +pMeasureExpect;

            var dataObj = new Object();
            dataObj["title"] = title;
            dataObj["ranges"] = [range_min, range_mid, range_max];
            dataObj["measures"] = [measure_actual, measure_expect];
            dataObj["markers"] = [marker];
            return dataObj;

        }

        function drawTargetBulletChart(targetBulletChart, data, containerObjectName) {
            var margin = {
                    top: 5,
                    right: 5,
                    bottom: 40,
                    left: 40
                },
                width = 80 - margin.left - margin.right,
                height = 180 - margin.top - margin.bottom;
            targetBulletChart.orient("bottom").width(width).height(height);
            bulletChartSvg = d3.select(containerObjectName).selectAll("svg").data(data).enter().append("svg").attr("class", "bullet").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom)
                .append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")").call(targetBulletChart);
            var title = bulletChartSvg.append("g").style("text-anchor", "end").attr("transform", "translate(" + width + "," + (height + 20) + ")");
            title.append("text").attr("class", "title").text(function(d) {
                return d.title
            });

        }

        drawSaleTargetBulletChartHospitality();
        drawSaleTargetBulletChartResidential();

    </script>


</body>

</html>
